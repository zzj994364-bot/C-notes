# 深度优先搜索 (Depth First Search)

## 基础

深度优先搜索（Depth First Search, DFS）是一种用于遍历或搜索树或图的算法。它从一个起始顶点出发，沿着一条路径尽可能深地探索，直到到达末端，然后回溯到上一个节点，继续探索其他未访问过的分支。DFS 遵循“一条路走到黑”的策略。

**解决的问题与应用**:
DFS 是图论和许多算法问题的基础，其应用非常广泛：

  * **路径**: 判断图中两个顶点之间是否存在路径。
  * **连通性**: 寻找图中的所有连通分量（Connected Components）。
  * **环路检测 (Cycle Detection)**: 在无向图和有向图中检测是否存在环路。
  * **拓扑排序 (Topological Sort)**: 在有向无环图（DAG）中，对顶点进行线性排序，使得对于每条有向边 `(u, v)`，`u` 都在 `v` 之前。
  * **回溯算法的引擎**: DFS 的探索与回溯机制是回溯算法的核心。许多搜索问题，如全排列、组合、N皇后、解数独、迷宫求解等，本质上都是 DFS。
  * **树的遍历**: 树的前序遍历、中序遍历和后序遍历都可以看作是 DFS 的特例。
  * **寻找桥和割点**: 在图的连通性分析中，寻找移除后会增加图连通分量数量的边（桥）或顶点（割点）。

时间/空间复杂度（使用邻接表表示图）：

  * **时间复杂度**: $O(V+E)$。其中 $V$ 是顶点数， $E$ 是边数。算法会访问每个顶点和每条边一次。
  * **空间复杂度**: $O(V)$。主要空间开销来自存储 `visited` 状态的数组，以及递归调用栈的深度，最坏情况下栈的深度可以达到 $V$（例如，图是一个长链）。

## 算法的流程

DFS 的核心流程可以通过递归清晰地描述：

1.  **初始化**: 创建一个 `visited` 数组（或哈希表），用于记录每个顶点是否被访问过，初始时所有顶点都标记为未访问。
2.  **主循环**: 遍历所有顶点 `u`（从 `0` 到 `V-1`）。如果顶点 `u` 尚未被访问，则调用 `dfs(u)` 开始一次新的搜索。这个主循环确保了即使图不是完全连通的，所有顶点也都会被访问到。
3.  **递归函数 `dfs(u)`**:
    a. **标记访问**: 将当前顶点 `u` 标记为已访问。
    b. **处理当前节点**: 对顶点 `u` 执行所需的操作（例如，打印、计数等）。
    c. **探索邻居**: 遍历 `u` 的所有邻居 `v`。
    d. **递归调用**: 如果邻居 `v` 尚未被访问，则对其递归调用 `dfs(v)`。
    e. **返回**: 当 `u` 的所有邻居都已被探索完毕，函数返回，程序回溯到调用 `dfs(u)` 的地方。

## 算法模板

从单个源点开始，对一个图（或图的一个连通分量）进行深度优先遍历。

```cpp
#include <vector>

const int MAXN = 100005;

vector<int> adj[MAXN];    // 邻接表
bool visited[MAXN];      // 访问标记数组
int n;                   // 顶点数

/**
 * @brief DFS 递归辅助函数
 * @param u 当前正在访问的顶点
 */
void dfs_helper(int u) {
    // 1. 将当前顶点标记为已访问
    visited[u] = true;

    // 2. 在这里可以对顶点 u 进行操作 (前序位置)
    // process(u);

    // 3. 遍历 u 的所有邻居 v
    for (int v : adj[u]) {
        // 4. 如果邻居 v 未被访问，则递归访问
        if (!visited[v]) {
            dfs_helper(v);
        }
    }
    
    // 5. 在这里也可以对顶点 u 进行操作 (后序位置)
    // process_after_children(u);
}

/**
 * @brief DFS 主函数，处理包含多个连通分量的图
 */
void dfs_main() {
    // 初始化所有顶点为未访问
    for (int i = 0; i < n; ++i) {
        visited[i] = false;
    }

    // 遍历所有顶点，确保每个连通分量都被访问到
    for (int i = 0; i < n; ++i) {
        if (!visited[i]) {
            // 从一个未访问的顶点开始新的 DFS
            dfs_helper(i);
        }
    }
}
```
