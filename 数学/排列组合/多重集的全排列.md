## 多重集的全排列

### 定义

**多重集**：允许元素重复出现的集合。

**多重集的全排列**：用多重集中的所有元素（包括重复元素）排成一列，有多少种不同的排列方式。

------

## 公式

如果多重集有 n 个元素，其中：

- 元素 a₁ 出现 n₁ 次
- 元素 a₂ 出现 n₂ 次
- ...
- 元素 aₖ 出现 nₖ 次

**全排列数 = n! / (n₁! × n₂! × ... × nₖ!)**

------

## 直观例子

### 例1：{1, 1, 2}

```
总共 3 个元素：两个1，一个2

如果把两个1区分开（标记为1ᴬ和1ᴮ）：
  [1ᴬ, 1ᴮ, 2]
  [1ᴬ, 2, 1ᴮ]
  [1ᴮ, 1ᴬ, 2]
  [1ᴮ, 2, 1ᴬ]
  [2, 1ᴬ, 1ᴮ]
  [2, 1ᴮ, 1ᴬ]
共 3! = 6 种

但两个1其实无法区分，所以：
  [1ᴬ, 1ᴮ, 2] 和 [1ᴮ, 1ᴬ, 2] 是同一种 → [1, 1, 2]
  [1ᴬ, 2, 1ᴮ] 和 [1ᴮ, 2, 1ᴬ] 是同一种 → [1, 2, 1]
  [2, 1ᴬ, 1ᴮ] 和 [2, 1ᴮ, 1ᴬ] 是同一种 → [2, 1, 1]

真实的排列只有 3 种
```

**计算：3! / 2! = 6 / 2 = 3**

------

### 例2：{A, A, B, B}

```
总共 4 个元素：两个A，两个B

全排列：
[A, A, B, B]
[A, B, A, B]
[A, B, B, A]
[B, A, A, B]
[B, A, B, A]
[B, B, A, A]

共 6 种
```

**计算：4! / (2! × 2!) = 24 / 4 = 6** ✓

------

### 例3：{1, 2, 2, 2, 3}

```
总共 5 个元素：
- 1 出现 1 次
- 2 出现 3 次  
- 3 出现 1 次

全排列数 = 5! / (1! × 3! × 1!) 
         = 120 / 6 
         = 20
```

------

## 为什么要除以 n₁! × n₂! × ...？

### 核心原理

**相同元素之间交换位置，排列不变！**

```
假设有 k 个相同元素：
  - 这 k 个元素内部可以有 k! 种排法
  - 但这 k! 种排法看起来都一样
  - 所以要除以 k! 去重
```

### 逐步理解

```
{1, 1, 2}:

Step 1: 假设所有元素都不同 → 3! = 6 种排列
Step 2: 但有 2 个 1 是相同的 → 除以 2! = 2
Step 3: 最终答案 = 6 / 2 = 3
{A, A, A, B}:

Step 1: 假设都不同 → 4! = 24 种
Step 2: 有 3 个 A 相同 → 除以 3! = 6  
Step 3: 最终答案 = 24 / 6 = 4

验证：[A,A,A,B] [A,A,B,A] [A,B,A,A] [B,A,A,A] ✓
```

------

## 实际应用场景

### 1. 单词字母重排

**问题**：MISSISSIPPI 有多少种不同的字母排列？

```
M: 1个
I: 4个
S: 4个
P: 2个
总共: 11个字母

答案 = 11! / (1! × 4! × 4! × 2!)
     = 39,916,800 / (1 × 24 × 24 × 2)
     = 34,650
```

### 2. 路径计数

**问题**：从 (0,0) 走到 (3,2)，只能向右(R)或向上(U)，有多少种路径？

```
需要：3个R，2个U
相当于排列 {R, R, R, U, U}

答案 = 5! / (3! × 2!) = 120 / 12 = 10
```

### 3. 分组问题

**问题**：6个人分成3组，每组2人，有多少种分法？

```
看成排列 [A,B | C,D | E,F]
- 6个人的排列：6!
- 每组内部顺序不重要：÷(2!)³
- 组之间顺序不重要：÷3!

答案 = 6! / (2!³ × 3!) = 720 / (8 × 6) = 15
```

------

## 与原题的关系

原题问的是**多重集的个数**，而不是**多重集的全排列数**：

```
n = 3 的非递减数组：

多重集         全排列数      非递减排列
{1:3}          1          [1,1,1]
{1:2,2:1}      3          [1,1,2]
{1:2,3:1}      3          [1,1,3]
{1:1,2:2}      3          [1,2,2]
{1:1,2:1,3:1}  6          [1,2,3]
...

原题统计的是"多重集个数" = C(5,3) = 10
如果统计"全排列数" = 1+3+3+3+6+... (更大的数)
```

**关键区别**：

- **多重集个数**：只看"有什么，各几个"
- **全排列数**：看"所有可能的排列方式"

原题利用单调性，每个多重集只对应唯一的单调排列，所以只需统计多重集个数！

------

## 记忆技巧

**"总排列数 ÷ 重复元素的自我排列数"**

```
公式：n! / (n₁! × n₂! × ... × nₖ!)
      ↑     ↑
   总数   每组相同元素内部的排列数
```